---
title: Troubleshooting Substrate Builds
slug: /v3/reference/troubleshoot-builds
version: '3.0'
section: docs
category: reference
keywords: install, troubleshoot, rustup, nightly, issue, problem, cargo, build,
---

Sometimes you can't get the Substrate nodes to compile as expected, without modification.
Here are some tips to help you work through that.

### Rust configuration check

To see what Rust toolchain you are presently using, run:

```bash
rustup show
```

This will show something like this (Ubuntu example) output:

```text
Default host: x86_64-unknown-linux-gnu
rustup home:  /home/user/.rustup

installed toolchains
--------------------

stable-x86_64-unknown-linux-gnu (default)
nightly-2020-10-06-x86_64-unknown-linux-gnu
nightly-x86_64-unknown-linux-gnu

installed targets for active toolchain
--------------------------------------

wasm32-unknown-unknown
x86_64-unknown-linux-gnu

active toolchain
----------------

stable-x86_64-unknown-linux-gnu (default)
rustc 1.50.0 (cb75ad5db 2021-02-10)
```

As you can see above, the default toolchain is stable, and the `nightly-x86_64-unknown-linux-gnu` toolchain as well as its `wasm32-unknown-unknown` target is installed.
You also see that `nightly-2020-10-06-x86_64-unknown-linux-gnu` is installed, but is not used unless explicitly defined as illustrated in the [specify your nightly version](#specifying-nightly-version) section.

### WebAssembly compilation

Substrate uses [WebAssembly](https://webassembly.org) (Wasm) to produce portable blockchain runtimes.
You will need to configure your Rust compiler to use [`nightly` builds](https://doc.rust-lang.org/book/appendix-07-nightly-rust.html) to allow you to compile Substrate runtime code to the Wasm target.

<Message
  type={`yellow`}
  title={`Soon use only the stable toolchain`}
  text={`
  There are upstream issues in Rust that need to be resolved before all of Substrate can use the stable Rust toolchain.
  This is [the tracking issue](https://github.com/paritytech/substrate/issues/1252) if you're curious as to why and how this will be resolved.
  `}
/>

#### Toolchain for specific Substrate release

Builders should always use the latest bug-free versions of Rust stable and nightly when they work to compile your project.
Because in the Substrate codebase follows closely to the tip of Rust nightly, changes in Substrate often depend on upstream changes in the Rust nightly compiler.
To ensure your Rust compiler is always up to date, you should run:

```bash
rustup update
# In your working directory, if new toolchain versions were installed
# clean to remove unusable artifacts
cargo clean
# build from scratch
cargo build --release
```

It _will_ be necessary to occasionally rerun `rustup update` if a change in the upstream Substrate codebase depends on a new feature of the Rust compiler.
When you do this, both your nightly and stable toolchains will be pulled to the most recent release, and for nightly, it is generally _not_ expected to compile WASM without error (although it very often does).
Be sure to [specify your nightly version](#specifying-nightly-version) if you get WASM build errors from `rustup` and [downgrade nightly as needed](#downgrading-rust-nightly).

#### Rust nightly toolchain

If you want to guarantee that your build works on your computer as you update Rust and other dependencies, you should use a specific Rust nightly version that is known to be compatible with the version of Substrate they are using; this version will vary from project to project and different projects may use different mechanisms to communicate this version to developers.
For instance, the Polkadot client specifies this information in its [release notes](https://github.com/paritytech/polkadot/releases).

```bash
# Specify the specific nightly toolchain in the date below:
rustup install nightly-yyyy-mm-dd
```

#### Wasm toolchain

Now, configure the nightly version to work with the Wasm compilation target:

```bash
# Specify the specific nightly toolchain in the date below:
rustup target add wasm32-unknown-unknown --toolchain nightly-yyyy-mm-dd
```

### Downgrading Rust nightly

If your computer is configured to use the latest Rust nightly and you would like to downgrade to a specific nightly version, follow these steps:

```sh
# Replace `yyyy-mm-dd` with the target date:
rustup uninstall nightly
rustup install nightly-yyyy-mm-dd
rustup target add wasm32-unknown-unknown --toolchain nightly-yyyy-mm-dd
```

### Specifying nightly version

Use the `WASM_BUILD_TOOLCHAIN` environment variable to specify the Rust nightly version a Substrate project should use for Wasm compilation:

```bash
# Replacing `yyyy-mm-dd` with the target date:
WASM_BUILD_TOOLCHAIN=nightly-yyyy-mm-dd cargo build --release
```

<br />
<Message
  type={`yellow`}
  title={`Only Wasm uses nightly`}
  text={`
  Note that this only builds _the Wasm runtime_ with the specified nightly.
  The rest of project will be compiled with **your default toolchain**, i.e. the latest installed stable toolchain.
  `}
/>
